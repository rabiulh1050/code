select 
LQCS_UCD_VND_SPST.FNM_LN_ID,
LQCS_UCD_VND_SPST.AUTOD_UWRG_CASE_ID,
LQCS_UCD_VND_SPST.AUTOD_UWRG_SYS_TI,
LQCS_UCD_VND_SPST.DATA_ENUM_TP,
LQCS_UCD_VND_SPST.TRAN_DIM_ID
LQCS_UCD_VND_SPST.LN_CUTOFF_DT,
LQCS_UCD_VND_SPST.LN_UCD_FACT_ID,
LQCS_UCD_VND_SPST.LN_CLSNG_CTCL_FBRWR_AMT,
LQCS_UCD_VND_SPST.LN_CLSNG_CTCL_TBRWR_AMT,
LQCS_UCD_VND_SPST.LN_MI_CO_NME_TYP_DIM_ID,
LQCS_UCD_VND_SPST.LN_MI_CO_NME_TYP,
LQCS_UCD_VND_SPST.LN_TOT_SBOR_FNCN_AMT,
LQCS_UCD_VND_SPST.LN_PRC_LOCK_DTTM,
LQCS_UCD_VND_SPST.LN_AVG_PRM_OFR_RT_PCT,
LQCS_UCD_VND_SPST.LN_PRC_QTE_INT_RT_PCT,
LQCS_UCD_VND_SPST.ln_RGLTN_Z_XCLDD_BFDPNT_PCT,
LQCS_UCD_VND_SPST.ln_PP_IND,
LQCS_UCD_VND_SPST.PRTY_UCD_FACT_ID, 
LQCS_UCD_VND_SPST.PRTY_ROLE_TYPE_DIM_ID,
LQCS_UCD_VND_SPST.PRTY_CTAC_FST_NME,
LQCS_UCD_VND_SPST.PRTY_CTAC_last_NME,
LQCS_UCD_VND_SPST.PRTY_CTAC_MDDL_NME,
LQCS_UCD_VND_SPST.PRTY_CTAC_SFX_NME,
LQCS_UCD_VND_SPST.LGL_ENTY_full_NME,
LQCS_UCD_VND_SPST.PRTY_TYP,
LQCS_UCD_VND_SPST.PROP_RE_AGNT_TYP,
LQCS_UCD_VND_SPST.PRTY_role_TYP_desc,
LQCS_UCD_VND_SPST.PRTY_EFF_EVNT_DTTM,
LQCS_UCD_VND_SPST.ln_UCD_DSCL_FACT_ID, 
LQCS_UCD_VND_SPST.ln_CC_LNDR_CREDITS_TOT_AMT,
LQCS_UCD_VND_SPST.ln_UCD_AUTOD_UWRG_FACT_ID ,
LQCS_UCD_VND_SPST.ln_AUTOD_UWRG_CASE_ID,
LQCS_UCD_VND_SPST.ln_AUTOD_UWRG_SYS_TYP ,
PLQCS_UCD_VND_SPST.ROP_UCD_FACT_ID ,
LQCS_UCD_VND_SPST.PROP_SLE_CTRT_AMT,
LQCS_UCD_VND_SPST.PRTY_role_ALT_ID ,
LQCS_UCD_VND_SPST.ln_CC_BRWR_PAID_TOT_AMT 
from
(
with LN_CFILE_ID as (WITH LN_UWRG AS (
    SELECT
        UWRG.FNM_LN_ID,
        TRIM(UWRG.AUTOD_UWRG_CASE_ID) AS AUTOD_UWRG_CASE_ID,
        UWRG.AUTOD_UWRG_SYS_TI,
        UWRG.MD_SRC_SYS_LKUP_OBJ_ID,
        CASE
            WHEN drvd.FNM_LN_ID IS NULL OR drvd.FNM_LN_ID = UWRG.FNM_LN_ID THEN UWRG.FNM_LN_ID
        END AS FNM_LN_IDD
    FROM
        ${RS_IDS_SCHEMA_NM}.LN_UWRG UWRG
        LEFT JOIN ${RS_UCD_CIN_CARE_SCHEMA_NM}.ln_appl_du_drvd drvd ON UWRG.AUTOD_UWRG_CASE_ID = drvd.FNM_CFILE_ID
    WHERE
        UWRG.MD_SRC_SYS_LKUP_OBJ_ID = 9999
),
FINS_LFC AS (
    SELECT
        MD_DATA_ENUM_LKUP_OBJ_ID
    FROM
        ${RS_IDS_SCHEMA_NM}.MD_DATA_ENUM_LKUP
    WHERE
        DATA_ENUM_ATTR_NM = 'FINS_LFC_TI'
        AND DATA_ENUM_TP = 'AtClosing'
),
LN_CACHE AS (
    SELECT
        LN_LN.FNM_LN_ID,
        NVL(LN_LN.AQSN_DT, LN_STC.NOTE_DT) AS LN_CUTOFF_DT
    FROM
        ${RS_IDS_SCHEMA_NM}.LN_LN
        LEFT JOIN ${RS_IDS_SCHEMA_NM}.LN_STC ON LN_LN.FNM_LN_ID = LN_STC.FNM_LN_ID
        JOIN FINS_LFC ON LN_STC.fins_lfc_ti = FINS_LFC.MD_DATA_ENUM_LKUP_OBJ_ID
    WHERE
        LN_LN.MD_SRC_SYS_LKUP_OBJ_ID = 9999
        AND LN_STC.MD_SRC_SYS_LKUP_OBJ_ID = 9999
),
LN_UCD_LTST_SPST AS (
    SELECT
        TRIM(FNM_CFILE_ID) AS FNM_CFILE_ID,
        TRAN_DIM_ID
    FROM
        ${RS_UCD_CIN_SCHEMA_NM}.LN_UCD_LTST_SPST_FACT
    WHERE
        EVNT_DTTM >= '2018-06-25'
),
UCD_VND_SPST AS (
    SELECT
        FNM_LN_ID
    FROM (
        SELECT
            FNM_LN_ID,
            ROW_NUMBER() OVER (PARTITION BY FNM_LN_ID ORDER BY FNM_LN_ID) AS rec_FNM_LN_ID
        FROM
            ${RS_CONV_TGT_DIM_SCHEMA_NM}.LQCS_UCD_VND_SPST
    ) fnl
    WHERE
        fnl.rec_FNM_LN_ID = 1
)
SELECT
    LN_UWRG.FNM_LN_ID,
    LN_UWRG.AUTOD_UWRG_CASE_ID,
    LN_UWRG.AUTOD_UWRG_SYS_TI,
    MD_DATA_ENUM_LKUP.DATA_ENUM_TP,
    LN_UCD_LTST_SPST.TRAN_DIM_ID,
    LN_CACHE.LN_CUTOFF_DT
FROM
    LN_UWRG
    JOIN ${RS_IDS_SCHEMA_NM}.MD_DATA_ENUM_LKUP ON LN_UWRG.AUTOD_UWRG_SYS_TI = MD_DATA_ENUM_LKUP.MD_DATA_ENUM_LKUP_OBJ_ID
    AND LN_UWRG.MD_SRC_SYS_LKUP_OBJ_ID = 9999
    JOIN LN_UCD_LTST_SPST ON TRIM(LN_UWRG.AUTOD_UWRG_CASE_ID) = LN_UCD_LTST_SPST.FNM_CFILE_ID
    LEFT JOIN LN_CACHE ON LN_CACHE.FNM_LN_ID = LN_UWRG.FNM_LN_ID
    LEFT JOIN UCD_VND_SPST ON LN_UWRG.FNM_LN_ID = UCD_VND_SPST.FNM_LN_ID
WHERE
    UCD_VND_SPST.FNM_LN_ID IS NULL
    AND LN_UWRG.FNM_LN_IDD IS NOT NULL)
    
	select
		cast (LN_UCD_FACT_REC_FNL.FNM_LN_ID as VARCHAR) as FNM_LN_ID,
		cast (LN_UCD_FACT_REC_FNL.AUTOD_UWRG_CASE_ID as VARCHAR) as AUTOD_UWRG_CASE_ID,
		cast (LN_UCD_FACT_REC_FNL.AUTOD_UWRG_SYS_TI as VARCHAR) as AUTOD_UWRG_SYS_TI,
		cast (LN_UCD_FACT_REC_FNL.DATA_ENUM_TP as VARCHAR) as DATA_ENUM_TP,
		cast (LN_UCD_FACT_REC_FNL.TRAN_DIM_ID as INT8) as TRAN_DIM_ID,
		LN_UCD_FACT_REC_FNL.LN_CUTOFF_DT,
		cast (LN_UCD_FACT_REC_FNL.LN_UCD_FACT_ID as VARCHAR) as LN_UCD_FACT_ID,
		cast (LN_UCD_FACT_REC_FNL.LN_CLSNG_CTCL_FBRWR_AMT as numeric) as LN_CLSNG_CTCL_FBRWR_AMT,
		cast (LN_UCD_FACT_REC_FNL.LN_CLSNG_CTCL_TBRWR_AMT as numeric) as LN_CLSNG_CTCL_TBRWR_AMT,
		cast (LN_UCD_FACT_REC_FNL.LN_MI_CO_NME_TYP_DIM_ID as INT8) as LN_MI_CO_NME_TYP_DIM_ID,
		cast (LN_UCD_FACT_REC_FNL.LN_MI_CO_NME_TYP as VARCHAR) as LN_MI_CO_NME_TYP,
		cast (LN_UCD_FACT_REC_FNL.LN_TOT_SBOR_FNCN_AMT as VARCHAR) as LN_TOT_SBOR_FNCN_AMT,
		cast (LN_UCD_FACT_REC_FNL.LN_PRC_LOCK_DTTM as TIMESTAMP) as LN_PRC_LOCK_DTTM,
		cast (LN_UCD_FACT_REC_FNL.LN_AVG_PRM_OFR_RT_PCT as numeric) as LN_AVG_PRM_OFR_RT_PCT,
		cast (LN_UCD_FACT_REC_FNL.LN_PRC_QTE_INT_RT_PCT as numeric) as LN_PRC_QTE_INT_RT_PCT,
		cast (LN_UCD_FACT_REC_FNL.ln_RGLTN_Z_XCLDD_BFDPNT_PCT as numeric) as ln_RGLTN_Z_XCLDD_BFDPNT_PCT,
		cast (LN_UCD_FACT_REC_FNL.ln_PP_IND as VARCHAR) as ln_PP_IND,
		cast (LN_UCD_FACT_REC_FNL.PRTY_UCDFACT_ID as VARCHAR) as PRTY_UCD_FACT_ID,
		cast (LN_UCD_FACT_REC_FNL.PRTY_ROLE_TYPE_DIM_ID as INT) as PRTY_ROLE_TYPE_DIM_ID,
		cast (LN_UCD_FACT_REC_FNL.PRTY_CTAC_FST_NME as VARCHAR) as PRTY_CTAC_FST_NME,
		cast (LN_UCD_FACT_REC_FNL.PRTY_CTAC_last_NME as VARCHAR) as PRTY_CTAC_last_NME,
		cast (LN_UCD_FACT_REC_FNL.PRTY_CTAC_MDDL_NME as VARCHAR) as PRTY_CTAC_MDDL_NME,
		cast (LN_UCD_FACT_REC_FNL.PRTY_CTAC_SFX_NME as VARCHAR) as PRTY_CTAC_SFX_NME,
		cast (LN_UCD_FACT_REC_FNL.LGL_ENTY_full_NME as VARCHAR) as LGL_ENTY_full_NME,
		cast (LN_UCD_FACT_REC_FNL.PRTY_TYP as VARCHAR) as PRTY_TYP,
		cast (LN_UCD_FACT_REC_FNL.PROP_RE_AGNT_TYP as VARCHAR) as PROP_RE_AGNT_TYP,
		cast (LN_UCD_FACT_REC_FNL.PRTY_role_TYP_desc as VARCHAR) as PRTY_role_TYP_desc,
		cast (LN_UCD_FACT_REC_FNL.PRTY_EFF_EVNT_DTTM as TIMESTAMP) as PRTY_EFF_EVNT_DTTM,
		cast (LN_UCD_FACT_REC_FNL.ln_UCD_DSCL_FACT_ID as VARCHAR) as ln_UCD_DSCL_FACT_ID ,
		cast (LN_UCD_FACT_REC_FNL.ln_CC_LNDR_CREDITS_TOT_AMT as numeric) as ln_CC_LNDR_CREDITS_TOT_AMT,
		cast (LN_UCD_FACT_REC_FNL.ln_UCD_AUTOD_UWRG_FACT_ID as VARCHAR) as ln_UCD_AUTOD_UWRG_FACT_ID,
		cast (LN_UCD_FACT_REC_FNL.ln_AUTOD_UWRG_CASE_ID as VARCHAR) as ln_AUTOD_UWRG_CASE_ID,
		cast (LN_UCD_FACT_REC_FNL.ln_AUTOD_UWRG_SYS_TYP as VARCHAR) as ln_AUTOD_UWRG_SYS_TYP,
		cast (LN_UCD_FACT_REC_FNL.PROP_UCD_FACT_ID as VARCHAR) as ROP_UCD_FACT_ID,
		cast (LN_UCD_FACT_REC_FNL.PROP_SLE_CTRT_AMT as numeric) as PROP_SLE_CTRT_AMT,
		cast (LN_UCD_FACT_REC_FNL.PRTY_role_ALT_ID as VARCHAR) as PRTY_role_ALT_ID,
		cast (LN_UCD_FACT_REC_FNL.ln_CC_BRWR_PAID_TOT_AMT as numeric) as ln_CC_BRWR_PAID_TOT_AMT
	from
		(
		select 
			FNM_LN_ID,
			AUTOD_UWRG_CASE_ID,
			AUTOD_UWRG_SYS_TI,
			DATA_ENUM_TP,
			LN_CFILE_ID.TRAN_DIM_ID
			LN_CFILE_ID.LN_CUTOFF_DT,
			LN_UCD_FACT_REC.LN_UCD_FACT_ID,
			LN_UCD_FACT_REC.LN_CLSNG_CTCL_FBRWR_AMT,
			LN_UCD_FACT_REC.LN_CLSNG_CTCL_TBRWR_AMT,
			LN_UCD_FACT_REC.LN_MI_CO_NME_TYP_DIM_ID,
			LN_UCD_FACT_REC.LN_MI_CO_NME_TYP,
			LN_UCD_FACT_REC.LN_TOT_SBOR_FNCN_AMT,
			LN_UCD_FACT_REC.LN_PRC_LOCK_DTTM,
			LN_UCD_FACT_REC.LN_AVG_PRM_OFR_RT_PCT,
			LN_UCD_FACT_REC.LN_PRC_QTE_INT_RT_PCT,
			LN_UCD_FACT_REC.ln_RGLTN_Z_XCLDD_BFDPNT_PCT,
			LN_UCD_FACT_REC.ln_PP_IND,
			null as PRTY_UCD_FACT_ID, 
			null as PRTY_ROLE_TYPE_DIM_ID,
			null as PRTY_CTAC_FST_NME,
			null as PRTY_CTAC_last_NME,
			null as PRTY_CTAC_MDDL_NME,
			null as PRTY_CTAC_SFX_NME,
			null as LGL_ENTY_full_NME,
			null as PRTY_TYP,
			null as PROP_RE_AGNT_TYP,
			null as PRTY_role_TYP_desc,
			null as PRTY_EFF_EVNT_DTTM,
			null as ln_UCD_DSCL_FACT_ID, 
			null as ln_CC_LNDR_CREDITS_TOT_AMT,
			null as ln_UCD_AUTOD_UWRG_FACT_ID ,
			null as ln_AUTOD_UWRG_CASE_ID,
			null as ln_AUTOD_UWRG_SYS_TYP ,
			null as PROP_UCD_FACT_ID ,
			null as PROP_SLE_CTRT_AMT,
			null as PRTY_role_ALT_ID ,
			null as ln_CC_BRWR_PAID_TOT_AMT )
		from LN_CFILE_ID
	left join (
				select 
					'LUF' as LN_UCD_FACT_ID, 
					LN_CLSNG_CTCL_FBRWR_AMT,
					LN_CLSNG_CTCL_TBRWR_AMT,
					LN_UCD_FACT.LN_MI_CO_NME_TYP_DIM_ID,
					TRIM(LN_MI_CO_NME_TYP) as LN_MI_CO_NME_TYP,
					LN_TOT_SBOR_FNCN_AMT,
					LN_PRC_LOCK_DTTM,
					LN_AVG_PRM_OFR_RT_PCT,
					LN_PRC_QTE_INT_RT_PCT,
					ln_RGLTN_Z_XCLDD_BFDPNT_PCT,
					case
						when LN_PP_IND =0 then 'N'
						when LN_PP_IND =1 then 'Y'
						else null
					end as LN_PP_IND,
					LN_UCD_FACT.TRAN_DIM_ID as TRAN_DIM_ID,
					TRIM(LN_UCD_FACT.FNM_CFILE_ID) as FNM_CFILE_ID
				from ${RS_UCD_CIN_SCHEMA_NM}.LN_UCD_FACT
				left join ${RS_UCD_CIN_SCHEMA_NM}.LN_MI_CO_NME_TYPE_DIM on 
					LN_UCD_FACT.LN_MI_CO_NME_TYPE_DIM_ID = LN_MI_CO_NME_TYPE_DIM.LN_MI_CO_NME_TYPE_DIM_ID
					where LN_UCD_FACT.EVNT_DIM_ID in (19)) LN_UCD_FACT_REC on 
					LN_CFILE_ID.AUTOD_UWRG_CASE_ID = LN_UCD_FACT_REC.FNM_CFILE_ID) LN_UCD_FACT_REC_FNL
					where 
					LN_UCD_FACT_REC_FNL.LN_UCD_FACT_ID is not null
					
UNION
	SELECT 
		cast (PRTY_UCD_FACT_FNL.FNM_LN_ID as VARCHAR) as FNM_LN_ID
		cast (PRTY_UCD_FACT_FNL.AUTOD_UWRG_CASE_ID as VARCHAR) as AUTOD_UWRG_CASE_ID,
		cast (PRTY_UCD_FACT_FNL.AUTOD_UWRG_SYS_TI as VARCHAR) as AUTOD_UWRG_SYS_TI,
		cast (PRTY_UCD_FACT_FNL.DATA_ENUM_TP as VARCHAR) as DATA_ENUM_TP,
		cast (PRTY_UCD_FACT_FNL.TRAN_DIM_ID as INT8) as TRAN_DIM_ID,
		PRTY_UCD_FACT_FNL.LN_CUTOFF_DT, 
		cast (PRTY_UCD_FACT_FNL.LN_UCD_FACT_ID as VARCHAR) as LN_UCD_FACT_ID,
		cast (PRTY_UCD_FACT_FNL.LN_CLSNG_CTCL_FBRWR_AMT as NUMERIC) as LN_CLSNG_CTCL_FBRWR_AMT,
		cast (PRTY_UCD_FACT_FNL.LN_CLSNG_CTCL_TBRWR_AMT as NUMERIC) as LN_CLSNG_CTCL_TBRWR_AMT,
		cast (PRTY_UCD_FACT_FNL.LN_MI_CO_NME_TYP_DIM_ID as INT8) as LN_MI_CO_NME_TYP_DIM_ID,
		cast (PRTY_UCD_FACT_FNL.LN_MI_CO_NME_TYP as VARCHAR) as LN_MI_CO_NME_TYP,
		cast (PRTY_UCD_FACT_FNL.LN_TOT_SBOR_FNCN_AMT as VARCHAR) as LN_TOT_SBOR_FNCN_AMT,
		cast (PRTY_UCD_FACT_FNL.LN_PRC_LOCK_DTTM as TIMESTAMP) as LN_PRC_LOCK_DTTM,
		cast (PRTY_UCD_FACT_FNL.LN_AVG_PRM_OFR_RT_PCT as NUMERIC) as LN_AVG_PRM_OFR_RT_PCT,
		cast (PRTY_UCD_FACT_FNL.LN_PRC_QTE_INT_RT_PCT as NUMERIC) as LN_PRC_QTE_INT_RT_PCT,
		cast (PRTY_UCD_FACT_FNL.ln_RGLTN_Z_XCLDD_BFDPNT_PCT as NUMERIC) as ln_RGLTN_Z_XCLDD_BFDPNT_PCT,
		cast (PRTY_UCD_FACT_FNL.ln_PP_IND as VARCHAR) as ln_PP_IND,
		cast (PRTY_UCD_FACT_FNL.PRTY_UCDFACT_ID as VARCHAR) as PRTY_UCDFACT_ID,
		cast (PRTY_UCD_FACT_FNL.PRTY_ROLE_TYPE_DIM_ID as INT) as PRTY_ROLE_TYPE_DIM_ID,
		cast (PRTY_UCD_FACT_FNL.PRTY_CTAC_FST_NME as VARCHAR) as PRTY_CTAC_FST_NME,
		cast (PRTY_UCD_FACT_FNL.PRTY_CTAC_last_NME as VARCHAR) as PRTY_CTAC_last_NME,
		cast (PRTY_UCD_FACT_FNL.PRTY_CTAC_MDDL_NME as VARCHAR) as PRTY_CTAC_MDDL_NME,
		cast (PRTY_UCD_FACT_FNL.PRTY_CTAC_SFX_NME as VARCHAR) as PRTY_CTAC_SFX_NME,
		cast (PRTY_UCD_FACT_FNL.LGL_ENTY_full_NME as VARCHAR) as LGL_ENTY_full_NME,
		cast (PRTY_UCD_FACT_FNL.PRTY_TYP as VARCHAR) as PRTY_TYP,
		cast (PRTY_UCD_FACT_FNL.PROP_RE_AGNT_TYP as VARCHAR) as PROP_RE_AGNT_TYP,
		cast (PRTY_UCD_FACT_FNL.PRTY_role_TYP_desc as VARCHAR) as PRTY_role_TYP_desc,
		cast (PRTY_UCD_FACT_FNL.PRTY_EFF_EVNT_DTTM as TIMESTAMP) as PRTY_EFF_EVNT_DTTM,
		cast (PRTY_UCD_FACT_FNL.ln_UCD_DSCL_FACT_ID as VARCHAR) as ln_UCD_DSCL_FACT_ID ,
		cast (PRTY_UCD_FACT_FNL.ln_CC_LNDR_CREDITS_TOT_AMT as NUMERIC) as ln_CC_LNDR_CREDITS_TOT_AMT,
		cast (PRTY_UCD_FACT_FNL.ln_UCD_AUTOD_UWRG_FACT_ID as VARCHAR) as ln_UCD_AUTOD_UWRG_FACT_ID,
		cast (PRTY_UCD_FACT_FNL.ln_AUTOD_UWRG_CASE_ID as VARCHAR) as ln_AUTOD_UWRG_CASE_ID,
		cast (PRTY_UCD_FACT_FNL.ln_AUTOD_UWRG_SYS_TYP as VARCHAR) as ln_AUTOD_UWRG_SYS_TYP,
		cast (PRTY_UCD_FACT_FNL.PROP_UCD_FACT_ID as VARCHAR) as ROP_UCD_FACT_ID,
		cast (PRTY_UCD_FACT_FNL.PROP_SLE_CTRT_AMT as NUMERIC) as PROP_SLE_CTRT_AMT,
		cast (PRTY_UCD_FACT_FNL.PRTY_role_ALT_ID as VARCHAR) as PRTY_role_ALT_ID,
		cast (PRTY_UCD_FACT_FNL.ln_CC_BRWR_PAID_TOT_AMT as NUMERIC) as ln_CC_BRWR_PAID_TOT_AMT
	from
		(select
			FNM_LN_ID,
			AUTOD_UWRG_CASE_ID,
			AUTOD_UWRG_SYS_TI,
			DATA_ENUM_TP,
			LN_CFILE_ID.TRAN_DIM_ID
			LN_CFILE_ID.LN_CUTOFF_DT,
			NULL AS LN_UCD_FACT_ID,
			NULL AS LN_CLSNG_CTCL_FBRWR_AMT,
			NULL AS LN_CLSNG_CTCL_TBRWR_AMT,
			NULL AS LN_MI_CO_NME_TYP_DIM_ID,
			NULL AS LN_MI_CO_NME_TYP,
			NULL AS LN_TOT_SBOR_FNCN_AMT,
			NULL AS LN_PRC_LOCK_DTTM,
			NULL AS LN_AVG_PRM_OFR_RT_PCT,
			NULL AS LN_PRC_QTE_INT_RT_PCT,
			NULL AS ln_RGLTN_Z_XCLDD_BFDPNT_PCT,
			NULL AS ln_PP_IND,
			PRTY_UCD_FACT_REC.PRTY_UCD_FACT_ID, 
			PRTY_UCD_FACT_REC.PRTY_ROLE_TYPE_DIM_ID,
			PRTY_UCD_FACT_REC.PRTY_CTAC_FST_NME,
			PRTY_UCD_FACT_REC.PRTY_CTAC_last_NME,
			PRTY_UCD_FACT_REC.PRTY_CTAC_MDDL_NME,
			PRTY_UCD_FACT_REC.PRTY_CTAC_SFX_NME,
			PRTY_UCD_FACT_REC.LGL_ENTY_full_NME,
			PRTY_UCD_FACT_REC.PRTY_TYP,
			PRTY_UCD_FACT_REC.PROP_RE_AGNT_TYP,
			PRTY_UCD_FACT_REC.PRTY_role_TYP_desc,
			PRTY_UCD_FACT_REC.PRTY_EFF_EVNT_DTTM,
			NULL AS ln_UCD_DSCL_FACT_ID, 
			NULL AS ln_CC_LNDR_CREDITS_TOT_AMT,
			NULL AS ln_UCD_AUTOD_UWRG_FACT_ID ,
			NULL AS ln_AUTOD_UWRG_CASE_ID,
			NULL AS ln_AUTOD_UWRG_SYS_TYP ,
			NULL AS PROP_UCD_FACT_ID ,
			NULL AS PROP_SLE_CTRT_AMT,
			NPRTY_UCD_FACT_REC.PRTY_role_ALT_ID ,
			NULL AS ln_CC_BRWR_PAID_TOT_AMT )
		from LN_CFILE_ID
		
			left join (
						select 
							distinct 'PRTYUF' as PRTY_UCD_FACT_ID,
							PRTY_UCD_FACT.TRAN_DIM_ID as TRAN_DIM_ID,
							PRTY_UCD_FACT.PRTY_ROLE_TYPE_DIM_ID as PRTY_ROLE_TYPE_DIM_ID,
							substring(trim(PRTY_UCD_FACT.PRTY_CTAC_FST_NME),1,200) as PRTY_CTAC_FST_NME,
							substring(trim(PRTY_UCD_FACT.PRTY_CTAC_last_NME),1,200) as PRTY_CTAC_last_NME,
							substring(trim(PRTY_UCD_FACT.PRTY_CTAC_MDDL_NME),1,200) as PRTY_CTAC_MDDL_NME,
							substring(trim(PRTY_UCD_FACT.PRTY_CTAC_SFX_NME),1,200) as PRTY_CTAC_SFX_NME,
							trim(PRTY_UCD_FACT.FNM_CFILE_ID) as FNM_CFILE_ID,
							case 
								when PRTY_UCD_FACT.LGL_ENTY_IND=1 then substring(trim(PRTY_UCD_FACT.LGL_ENTY_FULL_NME),1,200)
								else null
							end as LGL_ENTY_FULL_NME,
							case 
								when PRTY_UCD_FACT.LIND=1 then 'LegalEntity'
								when PRTY_UCD_FACT.LIND=0 then 'Person'
							end as PRTY_TYP,
							PRTY_UCD_FACT.PROP_RE_AGNT_TYP,
							trim(PRTY_ROLE_TYP_DESC) as PRTY_ROLE_TYPE_DESC,
							PRTY_UCD_FACT.EVNT_DTTM as PRTY_EFF_EVNT_DTTM,
							case 
								when trim(pluf.prty_lcns_id) is null then '999999999'
								else trim(pluf.prty_lcns_id)
							end as PRTY_ROLE_ALT_ID
						
						from ${RS_UCD_CSR_SCHEMA_NM}.PRTY_UCD_FACT
						left join ${RS_UCD_CIN_SCHEMA_NM}.PRTY_ROLE_TYP_DIM
						on PRTY_UCD_FACT.PRTY_ROLE_TYP_DIM_ID = PRTY_ROLE_TYP_DIM.PRTY_ROLE_TYP_DIM_ID
						left join ${RS_UCD_CIN_SCHEMA_NM}.PRTY_LCNS_UCD_FACT PLUF 
						on PLUF.FNM_CFILE_ID = PRTY_UCD_FACT.FNM_CFILE_ID
						and PLUF.EVNT_DIM_ID = PRTY_UCD_FACT.EVNT_DIM_ID
						and PLUF.TRAN_DIM_ID = PRTY_UCD_FACT.TRAN_DIM_ID
						and PLUF.PRTY_ROLE_TYP_DIM_ID = PRTY_UCD_FACT.PRTY_ROLE_TYP_DIM_ID
						and PLUF.LGL_ENTY_IND = PRTY_UCD_FACT.LGL_ENTY_IND
						and NVL(trim(PLUF.PrOP_REAGNT_TYPE),'999') = NVL(trim(PRTY_UCD_FACT.PrOP_REAGNT_TYPE),'999') 
						and PLUF.PRTY_ROLE_SEQ_NO = PRTY_UCD_FACT.PRTY_ROLE_SEQ_NO
						where 
							PRTY_UCD_FACT.EVNT_DIM_ID in (19) 
								and (PRTY_UCD_FACT.PRTY_ROLE_TYPE_DIM_ID in (43) 
								or (PRTY_UCD_FACT.PRTY_ROLE_TYPE_DIM_ID in (44) 
									and PRTY_UCD_FACT.PROP_RE_AGNT_TYP in ('LISTING', 'SELLING')))			
			) PRTY_UCD_FACT_REC on 
				LN_CFILE_ID.TRAN_DIM_ID = PRTY_UCD_FACT_REC.TRAN_DIM_ID
				and LN_CFILE_ID.AUTOD_UWRG_CASE_ID = PRTY_UCD_FACT_REC.FNM_CFILE_ID) PRTY_UCD_FACT_FNL
	where 
		PRTY_UCD_FACT_FNL.PRTY_UCD_FACT_ID is not NULL
	
where PROP_UDC_FACT_REC_FNL.PROP_UCD_FACT_ID is not NULL) LQCS_UCD_VND_SPST;
