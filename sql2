SELECT 
    LN_UWRG.FNM_LN_ID AS FNM_LN_ID, 
    AUTOD_UWRG_CASE_ID,
    DU_DRVD.CFILE_SMSS_ID,
    AUTOD_UWRG_SYS_TI,
    TRIM(DATA_ENUM_TP) AS DATA_ENUM_TP,
    LN_CACHE.LN_CUTOFF_DT
FROM 
    ${RS_IDS_SCHEMA_NM}.LN_UWRG
JOIN 
    ${RS_IDS_SCHEMA_NM}.MD_DATA_ENUM_LKUP
    ON LN_UWRG.AUTOD_UWRG_SYS_TI = MD_DATA_ENUM_LKUP.MD_DATA_ENUM_LKUP_OBJ_ID
    AND MD_DATA_ENUM_LKUP.MD_SRC_SYS_LKUP_OBJ_ID = 9999
JOIN 
    ${RS_DU_CHR_SCHEMA_NM}.LN_APPL_DU_DRVD DU_DRVD
    ON DU_DRVD.FNM_CFILE_ID = LN_UWRG.AUTOD_UWRG_CASE_ID
    AND DU_DRVD.FNM_LN_ID = LN_UWRG.FNM_LN_ID
LEFT JOIN (
    SELECT 
        LN_LN.FNM_LN_ID,
        NVL(LN_LN.AQSN_DT, LN_STC.NOTE_DT) AS LN_CUTOFF_DT 
    FROM 
        ${RS_IDS_SCHEMA_NM}.LN_LN
    LEFT JOIN 
        ${RS_IDS_SCHEMA_NM}.LN_STC ON LN_LN.FNM_LN_ID = LN_STC.FNM_LN_ID
    WHERE 
        LN_LN.MD_SRC_SYS_LKUP_OBJ_ID = 9999
        AND LN_STC.MD_SRC_SYS_LKUP_OBJ_ID = 9999
        AND LN_STC.FINS_LFC_TI IN (
            SELECT 
                MD_DATA_ENUM_LKUP_OBJ_ID 
            FROM 
                ${RS_IDS_SCHEMA_NM}.MD_DATA_ENUM_LKUP
            WHERE 
                DATA_ENUM_ATTR_NM = 'FINS_LFC_TI'
                AND DATA_ENUM_TP = 'AtClosing'
        )
) LN_CACHE ON LN_CACHE.FNM_LN_ID = LN_UWRG.FNM_LN_ID
LEFT JOIN (
    SELECT DISTINCT FNM_LN_ID
    FROM ${RS_CONV_TGT_DIM_SCHEMA_NM}.LQCS_DU_VND_SPST
) DU_VND_SPST ON LN_UWRG.FNM_LN_ID = DU_VND_SPST.FNM_LN_ID
WHERE 
    DU_VND_SPST.FNM_LN_ID IS NULL;













SELECT 
    d.FNM_LN_ID,
    d.AUTOD_UWRG_CASE_ID,
    d.CFILE_SMSS_ID,
    d.AUTOD_UWRG_SYS_TI,
    d.DATA_ENUM_TP,
    d.LN_CUTOFF_DT,
    CAST(NULL AS VARCHAR) AS CFILE_SMSS_OBJ_ID,
    CAST(NULL AS NUMERIC) AS LN_CLSNG_CTCL_FBRWR_AMT,
    CAST(NULL AS NUMERIC) AS LN_CLSNG_CTCL_TBRWR_AMT,
    CAST(NULL AS NUMERIC) AS LN_ESTD_CLSNG_COST_EXP_AMT,
    CAST(NULL AS NUMERIC) AS LN_AUTOD_UWRG_SELR_CTBN_AMT,
    CAST(NULL AS NUMERIC) AS BRWR_GRP_TOT_MTHY_HSNG_EXP_AMT,
    CAST(NULL AS NUMERIC) AS BRWR_GRP_TOT_PRPSD_MHEXP_AMT,
    CAST(NULL AS NUMERIC) AS LN_TOT_SBOR_FNCN_AMT,
    CAST(NULL AS VARCHAR) AS LN_APPL_BRWR_OBJ_ID,
    CAST(NULL AS VARCHAR) AS LAB_BRWR_APPLT_ID,
    CAST(NULL AS VARCHAR) AS LAB_FNM_CFILE_ID,
    CAST(NULL AS VARCHAR) AS LAB_CFILE_SMSS_ID,
    CAST(NULL AS VARCHAR) AS BRWR_AGE_AT_APPL_YRS_NO,
    CAST(NULL AS VARCHAR) AS BRWR_HMDA_RACE_TYP,
    CAST(NULL AS VARCHAR) AS BRWR_HMDA_ETHCY_TYP,
    CAST(NULL AS VARCHAR) AS BRWR_GNDR_TYP,
    CAST(NULL AS VARCHAR) AS BRWR_APPLT_SEQ_NO,
    CAST(NULL AS VARCHAR) AS BRWR_FST_NME,
    CAST(NULL AS VARCHAR) AS BRWR_LAST_NME,
    CAST(NULL AS VARCHAR) AS BRWR_TXPYR_ID,
    a.LN_APPL_BRWR_AST_OBJ_ID,
    a.LABA_BRWR_APPLT_ID,
    a.LABA_FNM_CFILE_ID,
    a.LABA_CFILE_SMSS_ID,
    a.BRWR_AST_TYP,
    a.BRWR_AST_NO,
    CAST(a.BRWR_AST_CASH_OR_MRKT_VAL_AMT AS NUMERIC) AS BRWR_AST_CASH_OR_MRKT_VAL_AMT
FROM 
    LN_DUFILE_ID AS d
LEFT JOIN (
    SELECT
        'LABA' AS LN_APPL_BRWR_AST_OBJ_ID,
        ast.BRWR_APPLT_ID AS LABA_BRWR_APPLT_ID,
        ast.BRWR_AST_NO,
        ast.BRWR_AST_CASH_OR_MRKT_VAL_AMT,
        ast.FNM_CFILE_ID AS LABA_FNM_CFILE_ID,
        ast.CFILE_SMSS_ID AS LABA_CFILE_SMSS_ID,
        TRIM(del.DATA_ENUM_TYP) AS BRWR_AST_TYP,
        ast.BRWR_AST_TYP_OBJ_ID
    FROM
        ${RS_DU_CRS_SCHEMA_NM}.LN_APPL_BRWR_AST AS ast
    JOIN ${RS_DU_CIN_SCHEMA_NM}.LN_APPL_BRWR AS brwr
        ON brwr.BRWR_APPLT_ID = ast.BRWR_APPLT_ID
        AND brwr.FNM_CFILE_ID = ast.FNM_CFILE_ID
        AND brwr.CFILE_SMSS_ID = ast.CFILE_SMSS_ID
    LEFT JOIN DATA_ENUM_LKUP AS del
        ON del.SRC_SYS_DATA_ENUM_LKUP_OBJ_ID = ast.BRWR_AST_TYP_OBJ_ID
) AS a
    ON d.AUTOD_UWRG_CASE_ID = a.LABA_FNM_CFILE_ID
    AND d.CFILE_SMSS_ID = a.LABA_CFILE_SMSS_ID
WHERE
    a.LN_APPL_BRWR_AST_OBJ_ID IS NOT NULL;






